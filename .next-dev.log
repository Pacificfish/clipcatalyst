
> dev
> next dev

  â–² Next.js 14.2.31
  - Local:        http://localhost:3000
  - Environments: .env.local

 âœ“ Starting...
 âœ“ Ready in 1232ms
 â—‹ Compiling / ...
 âœ“ Compiled / in 2.1s (516 modules)
 GET / 200 in 2158ms
 âœ“ Compiled /lab in 448ms (650 modules)
 âœ“ Compiled /api/usage in 178ms (423 modules)
 GET /api/usage 200 in 892ms
 â¨¯ ./app/api/generate/route.ts
Error: 
  [31mx[0m the name `email` is defined multiple times
    ,-[[36;1;4m/Users/everett/Desktop/clipcatalyst-next/app/api/generate/route.ts[0m:56:1]
 [2m56[0m |     if (userErr || !userData?.user) return NextResponse.json({ error: 'Unauthorized' }, { status: 401, headers })
 [2m57[0m |     const user = userData.user
 [2m58[0m |     const plan = String((user.user_metadata as any)?.plan || '').toLowerCase()
 [2m59[0m |     const email = (user.email || '').toLowerCase()
    : [31;1m          ^^|^^[0m
    :             [31;1m`-- [31;1mprevious definition of `email` here[0m[0m
 [2m60[0m |     const devOverride = (process.env.NEXT_PUBLIC_DEV_SUB_EMAILS || '')
 [2m61[0m |       .split(',')
 [2m62[0m |       .map(s => s.trim().toLowerCase())
 [2m63[0m |       .filter(Boolean)
 [2m64[0m |       .includes(email)
 [2m65[0m |     const hasSubscription = devOverride || ['beginner', 'pro', 'agency'].includes(plan)
 [2m66[0m |     if (!hasSubscription) return NextResponse.json({ error: 'Subscription required' }, { status: 403, headers })
 [2m67[0m | 
 [2m68[0m |     // Credits: enforce monthly allowanced usage (except agency)
 [2m69[0m |     const effectivePlan = (devOverride ? 'pro' : plan) as string
 [2m70[0m |     const allowance = getAllowanceForPlan(effectivePlan)
 [2m71[0m |     const period = currentPeriodStart()
 [2m72[0m |     let used = 0
 [2m73[0m |     if (allowance.monthly !== 'unlimited') {
 [2m74[0m |       const { data: usageRow, error: usageErr } = await supabaseAdmin
 [2m75[0m |         .from('usage_credits')
 [2m76[0m |         .select('used_credits')
 [2m77[0m |         .eq('user_id', user.id)
 [2m78[0m |         .eq('period_start', period)
 [2m79[0m |         .maybeSingle()
 [2m80[0m |       if (usageErr && usageErr.code !== 'PGRST116') {
 [2m81[0m |         return NextResponse.json({ error: 'Usage read failed', details: usageErr.message }, { status: 500, headers })
 [2m82[0m |       }
 [2m83[0m |       used = Number(usageRow?.used_credits || 0)
 [2m84[0m |       if (used >= allowance.monthly) {
 [2m85[0m |         return NextResponse.json({ error: 'Out of credits for this period' }, { status: 402, headers })
 [2m86[0m |       }
 [2m87[0m |     }
 [2m88[0m | 
 [2m89[0m |     const body = (await req.json()) as Payload
 [2m90[0m |     const { mode, source_text, source_url } = body
 [2m91[0m |     const language = body.language ?? 'English'
 [2m92[0m |     const tone = body.tone ?? 'Informative'
 [2m93[0m |     const topic = body.topic ?? ''
 [2m94[0m |     const email = (user.email ?? 'anon').toLowerCase()
    : [33;1m          ^^|^^[0m
    :             [33;1m`-- [33;1m`email` redefined here[0m[0m
 [2m95[0m |     const projectId = body.project_id || Math.random().toString(36).slice(2, 10)
 [2m96[0m | 
 [2m97[0m |     if (!mode || (mode === 'Paste' && !source_text) || (mode === 'URL' && !source_url)) {
    `----

Import trace for requested module:
./app/api/generate/route.ts
 â¨¯ ./app/api/generate/route.ts
Error: 
  [31mx[0m the name `email` is defined multiple times
    ,-[[36;1;4m/Users/everett/Desktop/clipcatalyst-next/app/api/generate/route.ts[0m:56:1]
 [2m56[0m |     if (userErr || !userData?.user) return NextResponse.json({ error: 'Unauthorized' }, { status: 401, headers })
 [2m57[0m |     const user = userData.user
 [2m58[0m |     const plan = String((user.user_metadata as any)?.plan || '').toLowerCase()
 [2m59[0m |     const email = (user.email || '').toLowerCase()
    : [31;1m          ^^|^^[0m
    :             [31;1m`-- [31;1mprevious definition of `email` here[0m[0m
 [2m60[0m |     const devOverride = (process.env.NEXT_PUBLIC_DEV_SUB_EMAILS || '')
 [2m61[0m |       .split(',')
 [2m62[0m |       .map(s => s.trim().toLowerCase())
 [2m63[0m |       .filter(Boolean)
 [2m64[0m |       .includes(email)
 [2m65[0m |     const hasSubscription = devOverride || ['beginner', 'pro', 'agency'].includes(plan)
 [2m66[0m |     if (!hasSubscription) return NextResponse.json({ error: 'Subscription required' }, { status: 403, headers })
 [2m67[0m | 
 [2m68[0m |     // Credits: enforce monthly allowanced usage (except agency)
 [2m69[0m |     const effectivePlan = (devOverride ? 'pro' : plan) as string
 [2m70[0m |     const allowance = getAllowanceForPlan(effectivePlan)
 [2m71[0m |     const period = currentPeriodStart()
 [2m72[0m |     let used = 0
 [2m73[0m |     if (allowance.monthly !== 'unlimited') {
 [2m74[0m |       const { data: usageRow, error: usageErr } = await supabaseAdmin
 [2m75[0m |         .from('usage_credits')
 [2m76[0m |         .select('used_credits')
 [2m77[0m |         .eq('user_id', user.id)
 [2m78[0m |         .eq('period_start', period)
 [2m79[0m |         .maybeSingle()
 [2m80[0m |       if (usageErr && usageErr.code !== 'PGRST116') {
 [2m81[0m |         return NextResponse.json({ error: 'Usage read failed', details: usageErr.message }, { status: 500, headers })
 [2m82[0m |       }
 [2m83[0m |       used = Number(usageRow?.used_credits || 0)
 [2m84[0m |       if (used >= allowance.monthly) {
 [2m85[0m |         return NextResponse.json({ error: 'Out of credits for this period' }, { status: 402, headers })
 [2m86[0m |       }
 [2m87[0m |     }
 [2m88[0m | 
 [2m89[0m |     const body = (await req.json()) as Payload
 [2m90[0m |     const { mode, source_text, source_url } = body
 [2m91[0m |     const language = body.language ?? 'English'
 [2m92[0m |     const tone = body.tone ?? 'Informative'
 [2m93[0m |     const topic = body.topic ?? ''
 [2m94[0m |     const email = (user.email ?? 'anon').toLowerCase()
    : [33;1m          ^^|^^[0m
    :             [33;1m`-- [33;1m`email` redefined here[0m[0m
 [2m95[0m |     const projectId = body.project_id || Math.random().toString(36).slice(2, 10)
 [2m96[0m | 
 [2m97[0m |     if (!mode || (mode === 'Paste' && !source_text) || (mode === 'URL' && !source_url)) {
    `----

Import trace for requested module:
./app/api/generate/route.ts
 â—‹ Compiling /_not-found ...
 â¨¯ ./app/api/generate/route.ts
Error: 
  [31mx[0m the name `email` is defined multiple times
    ,-[[36;1;4m/Users/everett/Desktop/clipcatalyst-next/app/api/generate/route.ts[0m:56:1]
 [2m56[0m |     if (userErr || !userData?.user) return NextResponse.json({ error: 'Unauthorized' }, { status: 401, headers })
 [2m57[0m |     const user = userData.user
 [2m58[0m |     const plan = String((user.user_metadata as any)?.plan || '').toLowerCase()
 [2m59[0m |     const email = (user.email || '').toLowerCase()
    : [31;1m          ^^|^^[0m
    :             [31;1m`-- [31;1mprevious definition of `email` here[0m[0m
 [2m60[0m |     const devOverride = (process.env.NEXT_PUBLIC_DEV_SUB_EMAILS || '')
 [2m61[0m |       .split(',')
 [2m62[0m |       .map(s => s.trim().toLowerCase())
 [2m63[0m |       .filter(Boolean)
 [2m64[0m |       .includes(email)
 [2m65[0m |     const hasSubscription = devOverride || ['beginner', 'pro', 'agency'].includes(plan)
 [2m66[0m |     if (!hasSubscription) return NextResponse.json({ error: 'Subscription required' }, { status: 403, headers })
 [2m67[0m | 
 [2m68[0m |     // Credits: enforce monthly allowanced usage (except agency)
 [2m69[0m |     const effectivePlan = (devOverride ? 'pro' : plan) as string
 [2m70[0m |     const allowance = getAllowanceForPlan(effectivePlan)
 [2m71[0m |     const period = currentPeriodStart()
 [2m72[0m |     let used = 0
 [2m73[0m |     if (allowance.monthly !== 'unlimited') {
 [2m74[0m |       const { data: usageRow, error: usageErr } = await supabaseAdmin
 [2m75[0m |         .from('usage_credits')
 [2m76[0m |         .select('used_credits')
 [2m77[0m |         .eq('user_id', user.id)
 [2m78[0m |         .eq('period_start', period)
 [2m79[0m |         .maybeSingle()
 [2m80[0m |       if (usageErr && usageErr.code !== 'PGRST116') {
 [2m81[0m |         return NextResponse.json({ error: 'Usage read failed', details: usageErr.message }, { status: 500, headers })
 [2m82[0m |       }
 [2m83[0m |       used = Number(usageRow?.used_credits || 0)
 [2m84[0m |       if (used >= allowance.monthly) {
 [2m85[0m |         return NextResponse.json({ error: 'Out of credits for this period' }, { status: 402, headers })
 [2m86[0m |       }
 [2m87[0m |     }
 [2m88[0m | 
 [2m89[0m |     const body = (await req.json()) as Payload
 [2m90[0m |     const { mode, source_text, source_url } = body
 [2m91[0m |     const language = body.language ?? 'English'
 [2m92[0m |     const tone = body.tone ?? 'Informative'
 [2m93[0m |     const topic = body.topic ?? ''
 [2m94[0m |     const email = (user.email ?? 'anon').toLowerCase()
    : [33;1m          ^^|^^[0m
    :             [33;1m`-- [33;1m`email` redefined here[0m[0m
 [2m95[0m |     const projectId = body.project_id || Math.random().toString(36).slice(2, 10)
 [2m96[0m | 
 [2m97[0m |     if (!mode || (mode === 'Paste' && !source_text) || (mode === 'URL' && !source_url)) {
    `----

Import trace for requested module:
./app/api/generate/route.ts
 â¨¯ ./app/api/generate/route.ts
Error: 
  [31mx[0m the name `email` is defined multiple times
    ,-[[36;1;4m/Users/everett/Desktop/clipcatalyst-next/app/api/generate/route.ts[0m:56:1]
 [2m56[0m |     if (userErr || !userData?.user) return NextResponse.json({ error: 'Unauthorized' }, { status: 401, headers })
 [2m57[0m |     const user = userData.user
 [2m58[0m |     const plan = String((user.user_metadata as any)?.plan || '').toLowerCase()
 [2m59[0m |     const email = (user.email || '').toLowerCase()
    : [31;1m          ^^|^^[0m
    :             [31;1m`-- [31;1mprevious definition of `email` here[0m[0m
 [2m60[0m |     const devOverride = (process.env.NEXT_PUBLIC_DEV_SUB_EMAILS || '')
 [2m61[0m |       .split(',')
 [2m62[0m |       .map(s => s.trim().toLowerCase())
 [2m63[0m |       .filter(Boolean)
 [2m64[0m |       .includes(email)
 [2m65[0m |     const hasSubscription = devOverride || ['beginner', 'pro', 'agency'].includes(plan)
 [2m66[0m |     if (!hasSubscription) return NextResponse.json({ error: 'Subscription required' }, { status: 403, headers })
 [2m67[0m | 
 [2m68[0m |     // Credits: enforce monthly allowanced usage (except agency)
 [2m69[0m |     const effectivePlan = (devOverride ? 'pro' : plan) as string
 [2m70[0m |     const allowance = getAllowanceForPlan(effectivePlan)
 [2m71[0m |     const period = currentPeriodStart()
 [2m72[0m |     let used = 0
 [2m73[0m |     if (allowance.monthly !== 'unlimited') {
 [2m74[0m |       const { data: usageRow, error: usageErr } = await supabaseAdmin
 [2m75[0m |         .from('usage_credits')
 [2m76[0m |         .select('used_credits')
 [2m77[0m |         .eq('user_id', user.id)
 [2m78[0m |         .eq('period_start', period)
 [2m79[0m |         .maybeSingle()
 [2m80[0m |       if (usageErr && usageErr.code !== 'PGRST116') {
 [2m81[0m |         return NextResponse.json({ error: 'Usage read failed', details: usageErr.message }, { status: 500, headers })
 [2m82[0m |       }
 [2m83[0m |       used = Number(usageRow?.used_credits || 0)
 [2m84[0m |       if (used >= allowance.monthly) {
 [2m85[0m |         return NextResponse.json({ error: 'Out of credits for this period' }, { status: 402, headers })
 [2m86[0m |       }
 [2m87[0m |     }
 [2m88[0m | 
 [2m89[0m |     const body = (await req.json()) as Payload
 [2m90[0m |     const { mode, source_text, source_url } = body
 [2m91[0m |     const language = body.language ?? 'English'
 [2m92[0m |     const tone = body.tone ?? 'Informative'
 [2m93[0m |     const topic = body.topic ?? ''
 [2m94[0m |     const email = (user.email ?? 'anon').toLowerCase()
    : [33;1m          ^^|^^[0m
    :             [33;1m`-- [33;1m`email` redefined here[0m[0m
 [2m95[0m |     const projectId = body.project_id || Math.random().toString(36).slice(2, 10)
 [2m96[0m | 
 [2m97[0m |     if (!mode || (mode === 'Paste' && !source_text) || (mode === 'URL' && !source_url)) {
    `----

Import trace for requested module:
./app/api/generate/route.ts
 POST /api/generate 500 in 1403ms
 GET /lab 500 in 4ms
 âœ“ Compiled /_error in 512ms (997 modules)
 GET /_next/static/webpack/1e5ea2b269f48f08.webpack.hot-update.json 500 in 461ms
 âš  Fast Refresh had to perform a full reload due to a runtime error.
 GET /lab 200 in 46ms
 GET /lab 200 in 16ms
 âœ“ Compiled /api/usage in 50ms (500 modules)
 GET /api/usage 200 in 436ms
 POST /api/generate 200 in 17300ms
 GET /api/usage 200 in 204ms
 âœ“ Compiled /api/render in 207ms (506 modules)
 POST /api/render 200 in 2800ms
 POST /api/render 200 in 1033ms
 POST /api/render 200 in 795ms
 âœ“ Compiled in 569ms (876 modules)
 â¨¯ ./app/lab/page.tsx
Error: 
  [31mx[0m Expression expected
     ,-[[36;1;4m/Users/everett/Desktop/clipcatalyst-next/app/lab/page.tsx[0m:154:1]
 [2m154[0m |   const disabled = isLoading || !source.trim();
 [2m155[0m | 
 [2m156[0m |   return (
 [2m157[0m |     <>
     : [31;1m     ^[0m
 [2m158[0m |       <Nav />
 [2m159[0m |       <main className="container py-16 space-y-8">
 [2m160[0m |         <header className="flex items-center justify-between">
     `----

  [31mx[0m Expected ',', got 'className'
     ,-[[36;1;4m/Users/everett/Desktop/clipcatalyst-next/app/lab/page.tsx[0m:156:1]
 [2m156[0m |   return (
 [2m157[0m |     <>
 [2m158[0m |       <Nav />
 [2m159[0m |       <main className="container py-16 space-y-8">
     : [31;1m            ^^^^^^^^^[0m
 [2m160[0m |         <header className="flex items-center justify-between">
 [2m161[0m |           <h1 className="text-3xl font-bold">Lab</h1>
 [2m162[0m |           <div className="flex items-center gap-3">
     `----

Caused by:
    Syntax Error

Import trace for requested module:
./app/lab/page.tsx
 GET /lab 500 in 4ms
 â¨¯ ./app/lab/page.tsx
Error: 
  [31mx[0m Expression expected
     ,-[[36;1;4m/Users/everett/Desktop/clipcatalyst-next/app/lab/page.tsx[0m:154:1]
 [2m154[0m |   const disabled = isLoading || !source.trim();
 [2m155[0m | 
 [2m156[0m |   return (
 [2m157[0m |     <>
     : [31;1m     ^[0m
 [2m158[0m |       <Nav />
 [2m159[0m |       <main className="container py-16 space-y-8">
 [2m160[0m |         <header className="flex items-center justify-between">
     `----

  [31mx[0m Expected ',', got 'className'
     ,-[[36;1;4m/Users/everett/Desktop/clipcatalyst-next/app/lab/page.tsx[0m:156:1]
 [2m156[0m |   return (
 [2m157[0m |     <>
 [2m158[0m |       <Nav />
 [2m159[0m |       <main className="container py-16 space-y-8">
     : [31;1m            ^^^^^^^^^[0m
 [2m160[0m |         <header className="flex items-center justify-between">
 [2m161[0m |           <h1 className="text-3xl font-bold">Lab</h1>
 [2m162[0m |           <div className="flex items-center gap-3">
     `----

Caused by:
    Syntax Error

Import trace for requested module:
./app/lab/page.tsx
 GET /_next/static/webpack/1e5ea2b269f48f08.webpack.hot-update.json 500 in 180ms
 âš  Fast Refresh had to perform a full reload due to a runtime error.
 GET /lab 500 in 5ms
 GET /lab 500 in 6ms
 â—‹ Compiling /_not-found ...
 â¨¯ ./app/lab/page.tsx
Error: 
  [31mx[0m Expression expected
     ,-[[36;1;4m/Users/everett/Desktop/clipcatalyst-next/app/lab/page.tsx[0m:154:1]
 [2m154[0m |   const disabled = isLoading || !source.trim();
 [2m155[0m | 
 [2m156[0m |   return (
 [2m157[0m |     <>
     : [31;1m     ^[0m
 [2m158[0m |       <Nav />
 [2m159[0m |       <main className="container py-16 space-y-8">
 [2m160[0m |         <header className="flex items-center justify-between">
     `----

  [31mx[0m Expected ',', got 'className'
     ,-[[36;1;4m/Users/everett/Desktop/clipcatalyst-next/app/lab/page.tsx[0m:156:1]
 [2m156[0m |   return (
 [2m157[0m |     <>
 [2m158[0m |       <Nav />
 [2m159[0m |       <main className="container py-16 space-y-8">
     : [31;1m            ^^^^^^^^^[0m
 [2m160[0m |         <header className="flex items-center justify-between">
 [2m161[0m |           <h1 className="text-3xl font-bold">Lab</h1>
 [2m162[0m |           <div className="flex items-center gap-3">
     `----

Caused by:
    Syntax Error

Import trace for requested module:
./app/lab/page.tsx
 GET /_next/static/webpack/1e5ea2b269f48f08.webpack.hot-update.json 500 in 378ms
 âš  Fast Refresh had to perform a full reload due to a runtime error.
 GET /lab 200 in 10ms
 GET /lab 500 in 11ms
 âœ“ Compiled /_not-found in 571ms (864 modules)
 GET /_next/static/webpack/1e5ea2b269f48f08.webpack.hot-update.json 500 in 589ms
 âš  Fast Refresh had to perform a full reload due to a runtime error.
 GET /lab 200 in 10ms
 GET /lab 200 in 20ms
 âœ“ Compiled /api/usage in 127ms (464 modules)
 GET /api/usage 200 in 1046ms
 âœ“ Compiled /api/generate in 163ms (500 modules)
 GET /api/usage 200 in 294ms
 GET /api/usage 200 in 466ms
 GET /api/usage 200 in 212ms
 GET /api/usage 200 in 182ms
 POST /api/generate 200 in 15034ms
 GET /api/usage 200 in 182ms
 âœ“ Compiled /api/render in 128ms (506 modules)
 POST /api/render 200 in 1455ms
 POST /api/render 200 in 755ms
 âœ“ Compiled in 296ms (862 modules)
 âœ“ Compiled /api/usage in 136ms (462 modules)
 GET /api/usage 200 in 743ms
 GET /api/usage 200 in 190ms
 GET /api/usage 200 in 119ms
 GET /api/usage 200 in 130ms
 GET /api/usage 200 in 217ms
 GET /api/usage 200 in 142ms
 GET /api/usage 200 in 171ms
 GET /api/usage 200 in 180ms
 GET /api/usage 200 in 135ms
 GET /api/usage 200 in 169ms
 GET /api/usage 200 in 101ms
 GET /api/usage 200 in 104ms
 GET /api/usage 200 in 142ms
 GET /api/usage 200 in 136ms
 GET /api/usage 200 in 115ms
 GET /api/usage 200 in 171ms
 GET /api/usage 200 in 131ms
 âœ“ Compiled / in 146ms (464 modules)
 GET /api/usage 200 in 510ms
[?25h
